#
# zabbix apache sites conf - Generated by Chef
#
<VirtualHost *:80>
  RewriteEngine on
  ReWriteCond %{SERVER_PORT} !^443$
  RewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName <%= @params[:server_name] %>
  ServerAlias <%= @params[:server_aliases].join(" ") %>
  DocumentRoot <%= @params[:doc_root] %>

  # AddOutputFilterByType DEFLATE text/html text/plain text/xml text/x-js text/css
  <Directory <%= @params[:doc_root] %> >
    AllowOverride FileInfo AuthConfig Limit Indexes
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    
    php_admin_value memory_limit 256M
    php_admin_value post_max_size 32M
    php_admin_value upload_max_filesize 16M
    php_admin_value max_execution_time 600
    php_admin_value max_input_time 600
    php_admin_value date.timezone "America/Los_Angeles"

    <Limit GET POST OPTIONS PROPFIND>
      Order allow,deny
      Allow from all
    </Limit>
    
    <LimitExcept GET POST OPTIONS PROPFIND>
      Order deny,allow
      Deny from all
    </LimitExcept>
    
  </Directory>

  SSLEngine On
  SSLCertificateFile /etc/apache2/ssl/<%= @params[:server_name] %>.crt
  SSLCertificateKeyFile /etc/apache2/ssl/<%= @params[:server_name] %>.key
</VirtualHost>

